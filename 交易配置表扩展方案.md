# 交易配置表扩展方案

## 一、现有表结构分析

### 1.1 已有字段

- ✅ 售后配置（退款理由、退货理由）
- ✅ 快递发货配置（全局包邮）
- ✅ 门店自提配置
- ✅ 包装费配置
- ✅ 分销配置

### 1.2 缺失字段

- ❌ `delivery_express_enabled` - 启用快递发货开关
- ❌ 同城配送所有配置字段（约30个字段）
- ❌ 门店自配送所有配置字段（约20个字段）

## 二、扩展方案对比

### 方案一：单表扩展（推荐）

**优点**：

- 查询简单，一次查询获取所有配置
- 单例模式，JOIN查询意义不大
- 维护简单，只需维护一张表

**缺点**：

- 表字段较多（约70+个字段）
- 字段分组不够直观

**适用场景**：配置字段总数量在100个以内，查询简单

### 方案二：拆分多表

**优点**：

- 表结构清晰，字段分组明确
- 每个配置模块独立维护

**缺点**：

- 需要JOIN查询（虽然只有一条记录）
- 更新需要更新多张表
- 维护成本增加

**适用场景**：配置字段非常多（100+），或者未来会持续扩展大量字段

## 三、推荐方案：单表扩展

考虑到：

1. 配置是单例模式，只有一条记录
2. 需要新增的字段约50个左右，不算太多
3. 查询场景简单，通常一次性获取所有配置
4. 维护成本低，只需维护一张表

**建议在现有表基础上扩展，新增同城配送和门店自配送的配置字段。**

## 四、需要新增的字段清单

### 4.1 快递发货配置

- `delivery_express_enabled` - 是否启用快递发货

### 4.2 同城配送配置（30个字段）

#### 基础配置

- `delivery_same_city_enabled` - 是否启用同城配送

#### 收费配置

- `same_city_charge_mode` - 计费方式（1-按距离，2-固定费用，3-自定义费用）
- `same_city_start_distance` - 起步距离（公里）
- `same_city_start_price` - 起步价（分）
- `same_city_extra_distance` - 续距（公里）
- `same_city_extra_price` - 续费（分）
- `same_city_max_distance` - 最大配送距离（公里）
- `same_city_fixed_price` - 固定配送费（分）

#### 自定义费用配置

- `same_city_custom_price_enabled` - 是否启用自定义费用
- `same_city_custom_min_price` - 最低配送费（分）
- `same_city_custom_max_price` - 最高配送费（分）
- `same_city_custom_need_audit` - 是否需要商家审核
- `same_city_custom_default_price` - 默认配送费（分）

#### 包邮配置

- `same_city_free_enabled` - 是否启用包邮
- `same_city_free_price` - 满额包邮金额（分）

#### 范围配置

- `same_city_delivery_center_latitude` - 配送中心纬度
- `same_city_delivery_center_longitude` - 配送中心经度
- `same_city_delivery_range` - 配送范围半径（公里）
- `same_city_delivery_range_description` - 配送范围限制说明

### 4.3 门店自配送配置（20个字段）

#### 基础配置

- `delivery_store_enabled` - 是否启用门店自配送

#### 收费配置

- `store_charge_mode` - 计费方式
- `store_start_distance` - 起步距离（公里）
- `store_start_price` - 起步价（分）
- `store_extra_distance` - 续距（公里）
- `store_extra_price` - 续费（分）
- `store_max_distance` - 最大配送距离（公里）
- `store_fixed_price` - 固定配送费（分）

#### 自定义费用配置

- `store_custom_price_enabled` - 是否启用自定义费用
- `store_custom_min_price` - 最低配送费（分）
- `store_custom_max_price` - 最高配送费（分）
- `store_custom_need_audit` - 是否需要商家审核
- `store_custom_default_price` - 默认配送费（分）

#### 包邮配置

- `store_free_enabled` - 是否启用包邮
- `store_free_price` - 满额包邮金额（分）

#### 范围配置

- `store_delivery_range_image_url` - 门店配送范围示意图URL

## 五、字段类型说明

### 5.1 现有表字段类型参考

| 字段类型        | 说明             | 示例                          |
| --------------- | ---------------- | ----------------------------- |
| `bit`           | 布尔值           | `delivery_pick_up_enabled`    |
| `tinyint(1)`    | 布尔值           | `packaging_fee_enabled`       |
| `int`           | 整数/金额（分）  | `delivery_express_free_price` |
| `varchar(512)`  | 字符串/理由列表  | `after_sale_refund_reasons`   |
| `varchar(2000)` | 长字符串/URL数组 | `brokerage_poster_urls`       |
| `varchar(32)`   | 短字符串/枚举值  | `brokerage_withdraw_types`    |

### 5.2 新增字段类型建议

- **布尔字段**：使用 `bit` 或 `tinyint(1)`（保持与现有表一致）
- **金额字段**：使用 `int`（与现有表一致，单位：分）
- **距离/坐标字段**：使用 `decimal(10,2)` 或 `decimal(10,6)`（需要小数精度）
- **文本字段**：使用 `varchar` 或 `text`（根据长度选择）
- **理由列表**：使用 `varchar(512)`（与现有表一致）

## 六、注意事项

### 6.1 现有字段的兼容性

1. **退款/退货理由字段**：

   - 现有：`varchar(512)`
   - 建议：如果支持JSON格式，可以保持不变；如果需要JSON数组，可以考虑后续改为JSON类型

2. **海报URL和提现方式**：
   - 现有：`varchar(2000)` 和 `varchar(32)`
   - 建议：保持现有格式，或者后续改为JSON类型

### 6.2 数据类型统一

- 金额字段统一使用 `int`（单位：分），与现有表保持一致
- 布尔字段统一使用 `bit` 或 `tinyint(1)`，建议使用 `bit`（更符合现有表风格）
- 距离和坐标字段使用 `decimal` 类型支持小数

### 6.3 默认值设置

- 所有新增字段都应该设置合理的默认值
- 布尔字段默认为 `b'0'`（false）
- 金额字段默认为 `0`
- 距离字段设置合理的默认值（如3.00、20.00）

## 七、建议

**推荐在现有表基础上扩展**，理由：

1. ✅ 配置是单例模式，查询场景简单
2. ✅ 新增字段数量适中（约50个）
3. ✅ 保持配置的集中管理，便于维护
4. ✅ 避免跨表JOIN，查询性能更好
5. ✅ 如果未来字段继续增加（超过100个），再考虑拆分表

如果需要拆分表，可以按模块拆分：

- `trade_config` - 主配置表（基础字段）
- `trade_config_same_city` - 同城配送配置表
- `trade_config_store_delivery` - 门店自配送配置表

但目前来看，**单表扩展是最合适的方案**。
