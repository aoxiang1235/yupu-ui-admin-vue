# 交易配置数据模型设计

## 一、数据模型概述

交易配置采用**单例模式**设计，整个系统只有一条主配置记录。配置数据分为以下几个模块：

1. **售后配置** - 退款/退货理由
2. **快递发货配置** - 全局包邮规则
3. **同城配送配置** - 收费规则、包邮规则、范围配置
4. **门店自配送配置** - 收费规则、包邮规则、范围配置
5. **包装费配置** - 包装费启用和金额
6. **分销配置** - 分销模式、佣金比例、提现规则

## 二、数据模型设计

### 2.1 主配置表 (trade_config)

采用**单表设计**，所有配置字段集中在一张表中。主要考虑：
- 配置是单例模式，不需要关联查询
- 配置字段相对固定，不会频繁扩展
- 简化查询和维护逻辑
- 金额字段统一以"分"为单位存储，前端显示时转换

### 2.2 字段分类说明

#### 2.2.1 售后配置字段
- `after_sale_refund_reasons` - 退款理由列表（JSON数组）
- `after_sale_return_reasons` - 退货理由列表（JSON数组）

#### 2.2.2 快递发货配置字段
- `delivery_express_enabled` - 是否启用快递发货（布尔）
- `delivery_express_free_enabled` - 是否启用全局包邮（布尔）
- `delivery_express_free_price` - 满额包邮金额（分）

#### 2.2.3 同城配送配置字段
- `delivery_same_city_enabled` - 是否启用同城配送（布尔）
- **收费配置**：
  - `same_city_charge_mode` - 计费方式（1-按距离，2-固定费用，3-自定义费用）
  - `same_city_start_distance` - 起步距离（公里，DECIMAL）
  - `same_city_start_price` - 起步价（分）
  - `same_city_extra_distance` - 续距（公里，DECIMAL）
  - `same_city_extra_price` - 续费（分）
  - `same_city_max_distance` - 最大配送距离（公里，DECIMAL）
  - `same_city_fixed_price` - 固定配送费（分）
- **自定义费用配置**：
  - `same_city_custom_price_enabled` - 是否启用自定义费用（布尔）
  - `same_city_custom_min_price` - 最低配送费（分）
  - `same_city_custom_max_price` - 最高配送费（分，0表示不限制）
  - `same_city_custom_need_audit` - 是否需要商家审核（布尔）
  - `same_city_custom_default_price` - 默认配送费（分）
- **包邮配置**：
  - `same_city_free_enabled` - 是否启用包邮（布尔）
  - `same_city_free_price` - 满额包邮金额（分）
- **范围配置**：
  - `same_city_delivery_center_latitude` - 配送中心纬度（DECIMAL）
  - `same_city_delivery_center_longitude` - 配送中心经度（DECIMAL）
  - `same_city_delivery_range` - 配送范围半径（公里，DECIMAL）
  - `same_city_delivery_range_description` - 配送范围限制说明（TEXT）

#### 2.2.4 门店自配送配置字段
- `delivery_store_enabled` - 是否启用门店自配送（布尔）
- **收费配置**：
  - `store_charge_mode` - 计费方式（1-按距离，2-固定费用，3-自定义费用）
  - `store_start_distance` - 起步距离（公里，DECIMAL）
  - `store_start_price` - 起步价（分）
  - `store_extra_distance` - 续距（公里，DECIMAL）
  - `store_extra_price` - 续费（分）
  - `store_max_distance` - 最大配送距离（公里，DECIMAL）
  - `store_fixed_price` - 固定配送费（分）
- **自定义费用配置**：
  - `store_custom_price_enabled` - 是否启用自定义费用（布尔）
  - `store_custom_min_price` - 最低配送费（分）
  - `store_custom_max_price` - 最高配送费（分，0表示不限制）
  - `store_custom_need_audit` - 是否需要商家审核（布尔）
  - `store_custom_default_price` - 默认配送费（分）
- **包邮配置**：
  - `store_free_enabled` - 是否启用包邮（布尔）
  - `store_free_price` - 满额包邮金额（分）
- **范围配置**：
  - `store_delivery_range_image_url` - 门店配送范围示意图URL（VARCHAR）

#### 2.2.5 包装费配置字段
- `packaging_fee_enabled` - 是否启用包装费（布尔）
- `packaging_fee_price` - 包装费金额（分）

#### 2.2.6 分销配置字段
- `brokerage_enabled` - 是否启用分销（布尔）
- `brokerage_enabled_condition` - 分佣模式（字典值）
- `brokerage_bind_mode` - 分销关系绑定模式（字典值）
- `brokerage_poster_urls` - 分销海报URL列表（JSON数组）
- `brokerage_first_percent` - 一级返佣比例（百分比，整数）
- `brokerage_second_percent` - 二级返佣比例（百分比，整数）
- `brokerage_withdraw_min_price` - 提现最低金额（分）
- `brokerage_withdraw_fee_percent` - 提现手续费百分比（百分比，整数）
- `brokerage_frozen_days` - 佣金冻结天数（整数）
- `brokerage_withdraw_types` - 提现方式列表（JSON数组）

## 三、数据类型说明

### 3.1 金额字段
- 所有金额字段统一使用 `BIGINT` 类型，以"分"为单位存储
- 前端显示时除以100转换为元
- 示例：10.50元 = 1050分

### 3.2 距离字段
- 使用 `DECIMAL(10,2)` 类型，支持小数点后2位
- 单位：公里

### 3.3 坐标字段
- 纬度：`DECIMAL(10,6)`，范围 -90.000000 到 90.000000
- 经度：`DECIMAL(11,6)`，范围 -180.000000 到 180.000000

### 3.4 JSON数组字段
- 使用 `JSON` 或 `TEXT` 类型存储
- MySQL 5.7+ 支持 JSON 类型，可以更好地验证和查询
- 存储格式：`["理由1", "理由2", "理由3"]`

### 3.5 布尔字段
- 使用 `TINYINT(1)` 类型，0表示false，1表示true

### 3.6 百分比字段
- 使用 `INT` 类型，存储整数值（如：10表示10%，0.5%存储为0）

## 四、索引设计

- **主键索引**：`id` 字段（PRIMARY KEY）
- 由于是单例模式，不需要额外索引

## 五、数据约束

1. **单例约束**：通过应用层逻辑保证只有一条记录（id=1）
2. **金额约束**：金额字段 >= 0
3. **距离约束**：距离字段 >= 0
4. **比例约束**：百分比字段范围 0-100
5. **坐标约束**：纬度范围 -90 到 90，经度范围 -180 到 180

