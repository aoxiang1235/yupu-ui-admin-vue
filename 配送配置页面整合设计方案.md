# 配送配置页面整合设计方案

## 📋 一、设计目标

将**所有配送管理功能**整合到**交易配置 → 配送**页面中，实现统一管理。

## 🎯 二、当前页面结构

### 2.1 交易配置页面（当前）
- **位置**：`src/views/mall/trade/config/index.vue`
- **配送标签页**：仅包含基础配置
  - 启用包邮
  - 满额包邮
  - 启用门店自提

### 2.2 独立的配送管理页面（需要整合）
1. **运费模板管理**：`src/views/mall/trade/delivery/expressTemplate/index.vue`
2. **快递公司管理**：`src/views/mall/trade/delivery/express/index.vue`
3. **门店自提管理**：`src/views/mall/trade/delivery/pickUpStore/index.vue`

## 🏗️ 三、整合设计方案

### 3.1 页面布局设计

```
交易配置 → 配送标签页
├── 【第一部分】配送方式开关配置
│   ├── 启用快递发货（新增）
│   ├── 启用门店自提（已有）
│   ├── 启用同城配送（预留，未实现功能）
│   └── 启用门店自配送（预留，未实现功能）
│
├── 【第二部分】全局包邮配置（已有）
│   ├── 启用包邮
│   └── 满额包邮
│
├── 【第三部分】运费模板管理（整合）
│   ├── 运费模板列表（表格）
│   ├── 新增运费模板按钮
│   ├── 编辑/删除操作
│   └── 支持搜索和筛选
│
├── 【第四部分】快递公司管理（整合）
│   ├── 快递公司列表（表格）
│   ├── 新增快递公司按钮
│   ├── 编辑/删除操作
│   └── 支持搜索和筛选
│
└── 【第五部分】门店自提管理（整合）
    ├── 门店列表（表格）
    ├── 新增门店按钮
    ├── 编辑/删除操作
    └── 支持搜索和筛选
```

### 3.2 功能模块划分

#### 模块一：配送方式开关（折叠面板/卡片）
```vue
<el-card header="配送方式开关">
  <el-form-item label="启用快递发货">
    <el-switch v-model="formData.deliveryExpressEnabled" />
  </el-form-item>
  <el-form-item label="启用门店自提">
    <el-switch v-model="formData.deliveryPickUpEnabled" />
  </el-form-item>
  <!-- 预留：同城配送、门店自配送 -->
</el-card>
```

#### 模块二：全局包邮配置（折叠面板/卡片）
```vue
<el-card header="全局包邮配置">
  <el-form-item label="启用包邮">
    <el-switch v-model="formData.deliveryExpressFreeEnabled" />
  </el-form-item>
  <el-form-item label="满额包邮">
    <el-input-number v-model="formData.deliveryExpressFreePrice" />
  </el-form-item>
</el-card>
```

#### 模块三：运费模板管理（表格 + 弹窗）
```vue
<el-card header="运费模板管理">
  <!-- 搜索栏 -->
  <el-form :inline="true">
    <el-form-item label="模板名称">
      <el-input v-model="expressTemplateQuery.name" />
    </el-form-item>
    <el-form-item>
      <el-button @click="handleExpressTemplateQuery">搜索</el-button>
      <el-button @click="openExpressTemplateForm('create')">新增模板</el-button>
    </el-form-item>
  </el-form>
  
  <!-- 表格 -->
  <el-table :data="expressTemplateList">
    <!-- 列定义 -->
  </el-table>
  
  <!-- 弹窗表单 -->
  <ExpressTemplateForm ref="expressTemplateFormRef" @success="handleExpressTemplateQuery" />
</el-card>
```

#### 模块四：快递公司管理（表格 + 弹窗）
```vue
<el-card header="快递公司管理">
  <!-- 搜索栏 -->
  <el-form :inline="true">
    <el-form-item label="快递公司名称">
      <el-input v-model="expressQuery.name" />
    </el-form-item>
    <el-form-item>
      <el-button @click="handleExpressQuery">搜索</el-button>
      <el-button @click="openExpressForm('create')">新增快递公司</el-button>
    </el-form-item>
  </el-form>
  
  <!-- 表格 -->
  <el-table :data="expressList">
    <!-- 列定义 -->
  </el-table>
  
  <!-- 弹窗表单 -->
  <ExpressForm ref="expressFormRef" @success="handleExpressQuery" />
</el-card>
```

#### 模块五：门店自提管理（表格 + 弹窗）
```vue
<el-card header="门店自提管理">
  <!-- 搜索栏 -->
  <el-form :inline="true">
    <el-form-item label="门店名称">
      <el-input v-model="pickUpStoreQuery.name" />
    </el-form-item>
    <el-form-item>
      <el-button @click="handlePickUpStoreQuery">搜索</el-button>
      <el-button @click="openPickUpStoreForm('create')">新增门店</el-button>
    </el-form-item>
  </el-form>
  
  <!-- 表格 -->
  <el-table :data="pickUpStoreList">
    <!-- 列定义 -->
  </el-table>
  
  <!-- 弹窗表单 -->
  <PickUpStoreForm ref="pickUpStoreFormRef" @success="handlePickUpStoreQuery" />
</el-card>
```

### 3.3 页面结构（完整代码框架）

```vue
<template>
  <ContentWrap>
    <el-form ref="formRef" :model="formData" :rules="formRules" label-width="120px">
      <el-tabs>
        <!-- 其他标签页... -->
        
        <!-- 配送标签页 -->
        <el-tab-pane label="配送">
          <!-- 第一部分：配送方式开关 -->
          <el-card class="mb-20px" shadow="never">
            <template #header>
              <span class="font-bold">配送方式开关</span>
            </template>
            <el-form-item label="启用快递发货" prop="deliveryExpressEnabled">
              <el-switch v-model="formData.deliveryExpressEnabled" />
              <el-text class="ml-10px" size="small" type="info">
                开启后，用户可以在APP端选择快递发货
              </el-text>
            </el-form-item>
            <el-form-item label="启用门店自提" prop="deliveryPickUpEnabled">
              <el-switch v-model="formData.deliveryPickUpEnabled" />
              <el-text class="ml-10px" size="small" type="info">
                开启后，用户可以在APP端选择门店自提
              </el-text>
            </el-form-item>
          </el-card>

          <!-- 第二部分：全局包邮配置 -->
          <el-card class="mb-20px" shadow="never">
            <template #header>
              <span class="font-bold">全局包邮配置</span>
            </template>
            <el-form-item label="启用包邮" prop="deliveryExpressFreeEnabled">
              <el-switch v-model="formData.deliveryExpressFreeEnabled" />
            </el-form-item>
            <el-form-item 
              v-if="formData.deliveryExpressFreeEnabled"
              label="满额包邮" 
              prop="deliveryExpressFreePrice"
            >
              <el-input-number
                v-model="formData.deliveryExpressFreePrice"
                :min="0"
                :precision="2"
                class="!w-xs"
              />
              <el-text class="ml-10px" size="small" type="info">
                单位：元
              </el-text>
            </el-form-item>
          </el-card>

          <!-- 第三部分：运费模板管理 -->
          <el-card class="mb-20px" shadow="never">
            <template #header>
              <span class="font-bold">运费模板管理</span>
            </template>
            <!-- 搜索和操作栏 -->
            <el-form :inline="true" class="mb-15px">
              <el-form-item label="模板名称">
                <el-input
                  v-model="expressTemplateQuery.name"
                  placeholder="请输入模板名称"
                  clearable
                  class="!w-240px"
                  @keyup.enter="handleExpressTemplateQuery"
                />
              </el-form-item>
              <el-form-item>
                <el-button @click="handleExpressTemplateQuery">
                  <Icon icon="ep:search" class="mr-5px" /> 搜索
                </el-button>
                <el-button @click="resetExpressTemplateQuery">
                  <Icon icon="ep:refresh" class="mr-5px" /> 重置
                </el-button>
                <el-button
                  type="primary"
                  @click="openExpressTemplateForm('create')"
                  v-hasPermi="['trade:delivery:express-template:create']"
                >
                  <Icon icon="ep:plus" class="mr-5px" /> 新增模板
                </el-button>
              </el-form-item>
            </el-form>
            
            <!-- 表格 -->
            <el-table v-loading="expressTemplateLoading" :data="expressTemplateList">
              <el-table-column label="编号" prop="id" width="80" />
              <el-table-column label="模板名称" prop="name" min-width="150" />
              <el-table-column label="计费方式" prop="chargeMode" width="120">
                <template #default="scope">
                  <dict-tag :type="DICT_TYPE.EXPRESS_CHARGE_MODE" :value="scope.row.chargeMode" />
                </template>
              </el-table-column>
              <el-table-column label="排序" prop="sort" width="80" />
              <el-table-column label="创建时间" prop="createTime" width="180" :formatter="dateFormatter" />
              <el-table-column label="操作" width="150" align="center" fixed="right">
                <template #default="scope">
                  <el-button
                    link
                    type="primary"
                    @click="openExpressTemplateForm('update', scope.row.id)"
                    v-hasPermi="['trade:delivery:express-template:update']"
                  >
                    编辑
                  </el-button>
                  <el-button
                    link
                    type="danger"
                    @click="handleExpressTemplateDelete(scope.row.id)"
                    v-hasPermi="['trade:delivery:express-template:delete']"
                  >
                    删除
                  </el-button>
                </template>
              </el-table-column>
            </el-table>
          </el-card>

          <!-- 第四部分：快递公司管理 -->
          <el-card class="mb-20px" shadow="never">
            <template #header>
              <span class="font-bold">快递公司管理</span>
            </template>
            <!-- 搜索和操作栏 -->
            <el-form :inline="true" class="mb-15px">
              <el-form-item label="快递公司名称">
                <el-input
                  v-model="expressQuery.name"
                  placeholder="请输入快递公司名称"
                  clearable
                  class="!w-240px"
                  @keyup.enter="handleExpressQuery"
                />
              </el-form-item>
              <el-form-item>
                <el-button @click="handleExpressQuery">
                  <Icon icon="ep:search" class="mr-5px" /> 搜索
                </el-button>
                <el-button @click="resetExpressQuery">
                  <Icon icon="ep:refresh" class="mr-5px" /> 重置
                </el-button>
                <el-button
                  type="primary"
                  @click="openExpressForm('create')"
                  v-hasPermi="['trade:delivery:express:create']"
                >
                  <Icon icon="ep:plus" class="mr-5px" /> 新增快递公司
                </el-button>
              </el-form-item>
            </el-form>
            
            <!-- 表格 -->
            <el-table v-loading="expressLoading" :data="expressList">
              <el-table-column label="编号" prop="id" width="80" />
              <el-table-column label="快递公司编号" prop="code" width="120" />
              <el-table-column label="快递公司名称" prop="name" min-width="150" />
              <el-table-column label="快递公司logo" prop="logo" width="100">
                <template #default="scope">
                  <el-image
                    v-if="scope.row.logo"
                    :src="scope.row.logo"
                    :preview-src-list="[scope.row.logo]"
                    style="width: 50px; height: 50px"
                  />
                </template>
              </el-table-column>
              <el-table-column label="排序" prop="sort" width="80" />
              <el-table-column label="状态" prop="status" width="100">
                <template #default="scope">
                  <dict-tag :type="DICT_TYPE.COMMON_STATUS" :value="scope.row.status" />
                </template>
              </el-table-column>
              <el-table-column label="操作" width="150" align="center" fixed="right">
                <template #default="scope">
                  <el-button
                    link
                    type="primary"
                    @click="openExpressForm('update', scope.row.id)"
                    v-hasPermi="['trade:delivery:express:update']"
                  >
                    编辑
                  </el-button>
                  <el-button
                    link
                    type="danger"
                    @click="handleExpressDelete(scope.row.id)"
                    v-hasPermi="['trade:delivery:express:delete']"
                  >
                    删除
                  </el-button>
                </template>
              </el-table-column>
            </el-table>
          </el-card>

          <!-- 第五部分：门店自提管理 -->
          <el-card class="mb-20px" shadow="never">
            <template #header>
              <span class="font-bold">门店自提管理</span>
            </template>
            <!-- 搜索和操作栏 -->
            <el-form :inline="true" class="mb-15px">
              <el-form-item label="门店名称">
                <el-input
                  v-model="pickUpStoreQuery.name"
                  placeholder="请输入门店名称"
                  clearable
                  class="!w-240px"
                  @keyup.enter="handlePickUpStoreQuery"
                />
              </el-form-item>
              <el-form-item>
                <el-button @click="handlePickUpStoreQuery">
                  <Icon icon="ep:search" class="mr-5px" /> 搜索
                </el-button>
                <el-button @click="resetPickUpStoreQuery">
                  <Icon icon="ep:refresh" class="mr-5px" /> 重置
                </el-button>
                <el-button
                  type="primary"
                  @click="openPickUpStoreForm('create')"
                  v-hasPermi="['trade:delivery:pick-up-store:create']"
                >
                  <Icon icon="ep:plus" class="mr-5px" /> 新增门店
                </el-button>
              </el-form-item>
            </el-form>
            
            <!-- 表格 -->
            <el-table v-loading="pickUpStoreLoading" :data="pickUpStoreList">
              <el-table-column label="编号" prop="id" width="80" />
              <el-table-column label="门店名称" prop="name" min-width="150" />
              <el-table-column label="门店地址" prop="address" min-width="200" />
              <el-table-column label="联系电话" prop="phone" width="120" />
              <el-table-column label="营业时间" prop="hours" width="150" />
              <el-table-column label="状态" prop="status" width="100">
                <template #default="scope">
                  <dict-tag :type="DICT_TYPE.COMMON_STATUS" :value="scope.row.status" />
                </template>
              </el-table-column>
              <el-table-column label="操作" width="200" align="center" fixed="right">
                <template #default="scope">
                  <el-button
                    link
                    type="primary"
                    @click="openPickUpStoreForm('update', scope.row.id)"
                    v-hasPermi="['trade:delivery:pick-up-store:update']"
                  >
                    编辑
                  </el-button>
                  <el-button
                    link
                    type="danger"
                    @click="handlePickUpStoreDelete(scope.row.id)"
                    v-hasPermi="['trade:delivery:pick-up-store:delete']"
                  >
                    删除
                  </el-button>
                </template>
              </el-table-column>
            </el-table>
          </el-card>
        </el-tab-pane>
      </el-tabs>

      <!-- 表单操作按钮 -->
      <el-form-item style="float: right; margin-top: 20px">
        <el-button @click="close">返回</el-button>
        <el-button type="primary" :loading="formLoading" @click="submitForm">
          保存配置
        </el-button>
      </el-form-item>
    </el-form>

    <!-- 运费模板表单弹窗 -->
    <ExpressTemplateForm ref="expressTemplateFormRef" @success="handleExpressTemplateQuery" />
    
    <!-- 快递公司表单弹窗 -->
    <ExpressForm ref="expressFormRef" @success="handleExpressQuery" />
    
    <!-- 门店自提表单弹窗 -->
    <PickUpStoreForm ref="pickUpStoreFormRef" @success="handlePickUpStoreQuery" />
  </ContentWrap>
</template>
```

## 📝 四、需要修改的文件

### 4.1 主要修改文件
1. **`src/views/mall/trade/config/index.vue`**
   - 扩展配送标签页内容
   - 整合三个管理模块的列表和操作
   - 引入子组件（表单弹窗）

### 4.2 需要引入的组件
1. **`ExpressTemplateForm.vue`** - 运费模板表单（已存在）
2. **`ExpressForm.vue`** - 快递公司表单（已存在）
3. **`PickUpStoreForm.vue`** - 门店自提表单（已存在）

### 4.3 需要引入的API
1. **运费模板API**：`@/api/mall/trade/delivery/expressTemplate`
2. **快递公司API**：`@/api/mall/trade/delivery/express`
3. **门店自提API**：`@/api/mall/trade/delivery/pickUpStore`

## ✅ 五、实施步骤

1. **第一步**：修改 `src/views/mall/trade/config/index.vue`
   - 扩展配送标签页的模板结构
   - 添加三个管理模块的卡片和表格

2. **第二步**：添加脚本逻辑
   - 添加三个模块的查询参数、列表数据、加载状态
   - 添加查询、重置、新增、编辑、删除方法
   - 引入API和组件

3. **第三步**：更新表单数据
   - 在 `formData` 中添加 `deliveryExpressEnabled` 字段
   - 更新表单验证规则

4. **第四步**：测试验证
   - 测试各个模块的CRUD操作
   - 测试表单提交和保存

## 🎨 六、UI/UX 设计要点

1. **卡片布局**：使用 `el-card` 分隔不同功能模块，清晰直观
2. **折叠面板**：可以考虑使用 `el-collapse` 让页面更紧凑
3. **响应式设计**：表格支持横向滚动，适配不同屏幕
4. **操作反馈**：所有操作都有成功/失败提示
5. **权限控制**：按钮和操作都加上权限判断

## ⚠️ 七、注意事项

1. **数据隔离**：三个管理模块的数据查询是独立的，互不影响
2. **表单提交**：只有基础配置（开关、包邮）需要提交到交易配置接口
3. **列表刷新**：每个模块的增删改操作后，只刷新对应的列表
4. **权限控制**：保持原有的权限控制逻辑
5. **代码复用**：尽量复用现有的表单组件，避免重复代码

---

## 📋 八、确认事项

请确认以下设计是否符合您的需求：

1. ✅ 将所有配送管理功能整合到一个页面
2. ✅ 使用卡片布局分隔不同功能模块
3. ✅ 保持原有的表单弹窗组件不变
4. ✅ 保持原有的API调用逻辑不变
5. ✅ 添加"启用快递发货"开关

**如果同意此设计方案，我将开始实施代码修改。**

