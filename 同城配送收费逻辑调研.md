# 同城配送收费逻辑调研

## 📋 一、主流平台收费逻辑概览

### 1.1 核心收费维度

同城配送的收费逻辑主要围绕以下几个核心维度：

| 收费维度 | 说明 | 应用场景 |
|---------|------|---------|
| **距离** | 根据配送距离计算费用 | 最常见，适用于大部分平台 |
| **重量** | 根据订单重量计算费用 | 顺丰同城、京东快递等 |
| **时段** | 根据配送时段（高峰期/普通时段）差异化定价 | 美团、饿了么等 |
| **固定费用** | 统一收费标准 | 简单场景或短距离配送 |
| **时效** | 加急配送额外收费 | 闪送、顺丰同城等 |
| **特殊服务** | 上楼费、夜间服务费等 | 个性化需求 |

---

## 🏢 二、主流平台收费逻辑详解

### 2.1 顺丰同城急送

**收费特点：**
- ✅ **按重量计费**：首重2元/公斤，续重2元/公斤
- ✅ **时效可选**：标准配送 vs 加急配送（加急额外收费）
- ✅ **距离限制**：通常在20-30公里范围内

**收费逻辑：**
```
配送费 = 首重价格 + (续重 × 续重单价)
例如：5公斤订单 = 2元 + (4公斤 × 2元) = 10元
```

### 2.2 闪送

**收费特点：**
- ✅ **按距离+重量计费**：起步价 + 距离加价 + 重量加价
- ✅ **新用户优惠**：新用户5公里以内，5公斤以下，约9元
- ✅ **时效保证**：1小时内送达（部分城市）

**收费逻辑：**
```
配送费 = 起步价 + (距离 - 起步距离) × 距离单价 + (重量 - 起步重量) × 重量单价
```

### 2.3 京东快递（同城）

**收费特点：**
- ✅ **按重量或体积计费**：大中城市5元/公斤，续重3元
- ✅ **区域差异化**：不同城市收费标准不同
- ✅ **体积重**：按体积重和实际重量取较大值

**收费逻辑：**
```
配送费 = 首重价格 + (续重 × 续重单价)
体积重 = 长 × 宽 × 高 / 6000（单位：cm）
实际费用 = max(按重量计费, 按体积重计费)
```

### 2.4 美团配送 / 饿了么

**收费特点：**
- ✅ **按距离+时段计费**：起步价 + 每公里加价
- ✅ **高峰期加价**：用餐高峰期（11:00-13:00, 17:00-19:00）额外收费
- ✅ **天气加价**：恶劣天气时段额外收费
- ✅ **订单金额包邮**：满额包邮（如满20元包邮）

**收费逻辑：**
```
基础配送费 = 起步价 + (距离 - 起步距离) × 每公里单价
实际配送费 = 基础配送费 × 时段系数（高峰期 > 1）
```

**时段系数示例：**
- 普通时段：1.0
- 高峰期（11:00-13:00, 17:00-19:00）：1.2-1.5
- 深夜时段（22:00-次日6:00）：1.3-1.8

---

## 💡 三、其他常见收费逻辑

### 3.1 按区域差异化定价

**应用场景：**
- 市中心 vs 郊区：市中心配送费更低（订单密集）
- 核心商圈 vs 偏远区域：偏远区域配送费更高

**收费逻辑：**
```
配送费 = 基础配送费 × 区域系数
区域系数：市中心 0.8-1.0，郊区 1.2-1.5，偏远区域 1.5-2.0
```

### 3.2 按订单金额包邮

**应用场景：**
- 满20元包邮
- 满50元包邮
- 会员专属包邮额度

**收费逻辑：**
```
if (订单金额 >= 包邮金额) {
    配送费 = 0
} else {
    配送费 = 按距离/重量/时段计算的费用
}
```

### 3.3 按商品类型差异化定价

**应用场景：**
- 生鲜商品：需要保温箱，额外收费2-5元
- 易碎品：需要特殊包装，额外收费
- 大件商品：需要额外人力，加收费用

**收费逻辑：**
```
配送费 = 基础配送费 + 特殊服务费
特殊服务费：保温箱费、包装费、上楼费等
```

### 3.4 动态调价（智能计价）

**应用场景：**
- 根据实时订单密度动态调整价格
- 根据配送员供需关系调整价格
- 根据天气、节假日等因素调整价格

**收费逻辑：**
```
基础配送费 = 按距离/重量/时段计算的费用
动态系数 = f(订单密度, 配送员数量, 天气, 节假日)
实际配送费 = 基础配送费 × 动态系数
```

---

## 📊 四、收费逻辑分类总结

### 4.1 按计费维度分类

| 计费维度 | 适用场景 | 优势 | 劣势 |
|---------|---------|------|------|
| **按距离** | 通用场景 | 简单直观，用户易理解 | 未考虑重量、时段等因素 |
| **按重量** | 重物配送 | 公平合理，成本可控 | 需要准确称重 |
| **按时段** | 餐饮、即时配送 | 高峰期溢价，提升收益 | 计算复杂，需要时段配置 |
| **固定费用** | 短距离、标准化配送 | 简单明了，易于管理 | 不够灵活 |
| **混合计费** | 复杂业务场景 | 覆盖多维度，更精准 | 配置复杂，用户理解成本高 |

### 4.2 按业务类型分类

| 业务类型 | 主要收费逻辑 | 示例平台 |
|---------|-------------|---------|
| **外卖配送** | 距离 + 时段 | 美团、饿了么 |
| **即时配送** | 距离 + 重量 + 时效 | 闪送、达达 |
| **同城快递** | 重量 + 体积 | 顺丰同城、京东 |
| **生鲜配送** | 距离 + 时段 + 保温服务 | 盒马、叮咚买菜 |

---

## 🔧 五、当前系统已实现的收费逻辑

### 5.1 已实现（快递发货）

✅ **按件计费**：根据商品数量
✅ **按重量计费**：根据商品重量（kg）
✅ **按体积计费**：根据商品体积（m³）
✅ **区域差异化**：不同区域使用不同的运费模板
✅ **全局包邮**：满额包邮（交易配置）
✅ **活动包邮**：满减送活动包邮
✅ **运费模板包邮**：按件数/金额包邮
✅ **运费分摊**：多个商品时，运费按比例分摊到每个商品

### 5.2 待实现（同城配送）

基于调研结果，建议实现以下收费逻辑：

#### ✅ 1. 按距离计费（已设计）
```
起步距离：3km
起步价：10元
续距：每1km
续费：5元
最大配送距离：20km

计算示例：
- 2km → 10元（在起步距离内）
- 5km → 10 + (5-3)×5 = 20元
- 25km → 不支持配送（超过最大距离）
```

#### ✅ 2. 固定费用（已设计）
```
固定配送费：15元
最大配送距离：20km

适用于：短距离标准化配送场景
```

#### ✅ 3. 按时间段计费（已设计）
```
普通时段配送费：10元
高峰期配送费：15元
高峰期时段：11:00-13:00, 17:00-19:00

计算逻辑：
- 普通时段订单 → 10元
- 高峰期订单 → 15元
```

#### ⚠️ 4. 按重量计费（建议增加）
```
起步重量：3kg
起步价：10元
续重：每1kg
续费：3元
最大重量：20kg

适用场景：重物配送（如生鲜、大件商品）
```

#### ⚠️ 5. 区域差异化定价（建议增加）
```
区域系数配置：
- 核心商圈：0.8（8折，订单密集，成本低）
- 普通区域：1.0（标准价格）
- 郊区：1.2（1.2倍，距离远，成本高）
- 偏远区域：1.5（1.5倍，覆盖成本）

计算逻辑：
实际配送费 = 基础配送费 × 区域系数
```

#### ⚠️ 6. 动态调价（可选，高级功能）
```
动态系数 = f(订单密度, 天气, 节假日)

实际配送费 = 基础配送费 × 动态系数

适用场景：
- 高峰期订单密集 → 动态系数 1.2
- 恶劣天气 → 动态系数 1.3
- 节假日 → 动态系数 1.2
```

#### ✅ 7. 包邮规则（已设计）
```
启用包邮：开关控制
满额包邮金额：如满50元包邮

计算逻辑：
if (订单金额 >= 满额包邮金额) {
    配送费 = 0
} else {
    配送费 = 按距离/固定/时段计算的费用
}
```

---

## 📋 六、推荐实现优先级

### 🔥 高优先级（核心功能）

1. **按距离计费** ✅ 已实现
   - 适用场景最广
   - 用户理解成本低
   - 实现相对简单

2. **固定费用** ✅ 已实现
   - 适合标准化场景
   - 简单易用

3. **包邮规则** ✅ 已实现
   - 提升转化率
   - 用户期望功能

### ⭐ 中优先级（增强功能）

4. **按时间段计费** ✅ 已实现
   - 高峰期溢价，提升收益
   - 平衡配送员供需

5. **按重量计费** ⚠️ 建议增加
   - 适用于重物配送场景
   - 公平合理

6. **区域差异化定价** ⚠️ 建议增加
   - 精细化运营
   - 成本控制

### 💎 低优先级（高级功能）

7. **动态调价** ⚠️ 可选实现
   - 需要大数据支持
   - 计算复杂
   - 适合成熟业务

8. **特殊服务费** ⚠️ 可选实现
   - 保温箱费
   - 上楼费
   - 夜间服务费等

---

## 🎯 七、实施建议

### 7.1 第一阶段（当前）

✅ **已完成：**
- 按距离计费
- 固定费用
- 按时间段计费
- 包邮规则

### 7.2 第二阶段（建议补充）

⚠️ **建议增加：**
1. **按重量计费**
   - 扩展 `sameCityChargeMode` 为 4（按重量）
   - 添加 `sameCityStartWeight`（起步重量）、`sameCityStartPrice`（起步价）
   - 添加 `sameCityExtraWeight`（续重）、`sameCityExtraPrice`（续费）
   - 添加 `sameCityMaxWeight`（最大重量）

2. **区域差异化定价**
   - 添加 `sameCityAreaPriceConfig`（区域价格配置表）
   - 支持按区域设置不同的价格系数
   - 在计算配送费时应用区域系数

### 7.3 第三阶段（可选）

💎 **高级功能：**
1. **动态调价**
   - 接入实时订单密度数据
   - 接入天气API
   - 实现动态系数计算

2. **特殊服务费**
   - 保温箱费配置
   - 上楼费配置
   - 夜间服务费配置

---

## 📚 八、参考资料

1. **顺丰同城急送**：首重2元/公斤，续重2元/公斤
2. **闪送**：新用户5公里以内，5公斤以下，约9元
3. **京东快递**：大中城市5元/公斤，续重3元
4. **美团配送/饿了么**：起步价 + 每公里加价 + 时段系数

---

## ✅ 总结

当前系统已经实现了**按距离计费**、**固定费用**、**按时间段计费**和**包邮规则**，这些功能覆盖了大部分同城配送的业务场景。

**建议下一步：**
1. 根据实际业务需求，评估是否需要增加"按重量计费"
2. 如果有区域差异化需求，可以增加"区域差异化定价"
3. 动态调价属于高级功能，建议在业务成熟后再考虑

**当前实现的收费逻辑已经可以满足大部分同城配送的业务需求。** 🎉

